#!/bin/bash

set -euo pipefail

# Pretty print functions
info()    { echo -e "\033[1;34m[INFO]\033[0m $*"; }
warn()    { echo -e "\033[1;33m[WARN]\033[0m $*"; }
error()   { echo -e "\033[1;31m[ERROR]\033[0m $*"; }
success() { echo -e "\033[1;32mâœ… $*\033[0m"; }

{{ if eq .chezmoi.osRelease.id "pop" }}
sudo apt update
info "Installing Homebrew dependencies..."
sudo apt install -y build-essential procps curl file git
success "Homebrew dependencies installed."
{{ end }}

if ! command -v brew >/dev/null 2>&1; then
    info "Installing Homebrew..."
    bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

    if [[ $? -ne 0 ]]; then
        error "Homebrew installation failed."
        exit 1
    else
        {{ if eq .chezmoi.os "linux" }}
        echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.bashrc
        {{ end }}
        success "Homebrew installed successfully."
    fi
fi
